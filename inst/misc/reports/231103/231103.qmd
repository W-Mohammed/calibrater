---
format:
  revealjs:
    # theme: dark
    # smaller: true
    width: 1920
    height: 1080
    scrollable: true
    self-contained: true
---

```{r}
#| echo: false
#| include: false
# Load library:
devtools::load_all()
# Read-in data:
evppi_1 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_1/data/ls_EVPPI_tables.rds"
))
abTab_1 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_1/data/Combined_Absolute.rds"
))
reTab_1 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_1/data/Combined_Relative.rds"
))
evppi_2 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_2/data/ls_EVPPI_tables.rds"
))
abTab_2 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_2/data/Combined_Absolute.rds"
))
reTab_2 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_2/data/Combined_Relative.rds"
))
evppi_3 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_3/data/ls_EVPPI_tables.rds"
))
abTab_3 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_3/data/Combined_Absolute.rds"
))
reTab_3 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_3/data/Combined_Relative.rds"
))
evppi_4 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_4/data/ls_EVPPI_tables.rds"
))
abTab_4 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_4/data/Combined_Absolute.rds"
))
reTab_4 = readRDS(file = file.path(
  here::here(),
  "inst/misc/reports/231103/Case_study_4/data/Combined_Relative.rds"
))
```

# Calibration of a hypothetical infectious disease model

`r Sys.Date()`

# Introduction

## Model: Infectious disease model

::: panel-tabset
### Model description

- The model (Nicolas *et al.,*, 2017) is adapted from approaches for modelling HIV in high-burden settings. 
- The population is divided into five health states including non-susceptible (N), susceptible (S), early disease (E), late disease (L), and treatment (T). The number of individuals by state and year (t) is given by $N_t$, $S_t$, $E_t$, $L_t$, and $T_t$ respectively. 
- Individuals enter the model distributed across the $N$ and $S$ states, and transition between states to allow for infection ($S$ to $E$), disease progression ($E$ to $L$), treatment initiation ($E$ and $L$ to $T$), and death ($N$, $S$, $E$, $L$ and $T$ to $D$) via background and disease-specific mortality. 
- See model diagram in the next tab.

### Model structure

![](HIV_model.JPG){width=50% height=50%}

### Parameter transformations:

-   Two calibration process was carried out twice, with and without parameter-transformation.

-   Parameter-transformation was introduced because some of the employed optimisation algorithms (direct search methods) operate without bounds, i.e. an algorithm could end up passing values from outside the supported parameter space (between $-\infty, \infty$ for rates or probabilities) to the model which could lead to unrealistic results\* (negative survival).

-   The calibration parameters were transformed as follows:

    -   `b` was transformed to the entire real line $(-\infty, \infty)$ using `logit`.
    -   All other parameters were transformed using `log`.
:::

## Calibration process specifications:

::: panel-tabset
### Calibration parameters:

-   `mu_e` Cause-specific mortality rate with early-stage disease
-   `mu_l` Cause-specific mortality rate with late-stage disease
-   `mu_t` Cause-specific mortality rate on treatment
-   `p` Transition rate from early to late-stage disease
-   `r_l` Rate of uptake onto treatment (r_l = late-stage disease)
-   `rho` Effective contact rate
-   `b` Fraction of population in at-risk group

### Calibration targets:

-   `Prev` Prevalence at 10, 20, 30 years
-   `Surv` HIV survival without treatment
-   `Trt_vol` Treatment volume at 30 years

### Search method:

-   Random search using:
    -   RGS
-   Directed search using:
    -   Nelder-Mead (NM) algorithm, aka simplex method (derivative free)
-   Bayesian methods:
    -   Incremental Mixture Importance Sampling (IMIS)

### Goodness-of-fit measure:

-   Sum of log-likelihoods

### Calibration scenarios:

Four calibration scenarios were analysed.
-   Scenario 1 involved **2** parameters
-   Scenario 1 involved **3** parameters
-   Scenario 1 included **6** parameters
-   Scenario 4 included all **7** parameters
:::

# Results

## Scenario 1:

### Two parameters:

::: panel-tabset
#### Cost-effectiveness results:

```{r}
#| echo: false
#| out.width: '100%'
# Print absolute results tables:
abTab_1
```

#### Cost-effectiveness results (relative):

```{r}
#| echo: false
#| out.width: '100%'
# Print relative results tables:
reTab_1
```

#### EVPPI:

```{r}
#| echo: false
#| out.width: '100%'
# Print relative results tables:
evppi_1
```
:::

------------------------------------------------------------------------

## Scenario 2:

### Three parameters:

::: panel-tabset
#### Cost-effectiveness results:

```{r}
#| echo: false
#| out.width: '100%'
# Print absolute results tables:
abTab_2
```

#### Cost-effectiveness results (relative):

```{r}
#| echo: false
#| out.width: '100%'
# Print relative results tables:
reTab_2
```

#### EVPPI:

```{r}
#| echo: false
#| out.width: '100%'
# Print relative results tables:
evppi_2
```
:::

------------------------------------------------------------------------

## Scenario 3:

### Six parameters:

::: panel-tabset
#### Cost-effectiveness results:

```{r}
#| echo: false
#| out.width: '100%'
# Print absolute results tables:
abTab_3
```

#### Cost-effectiveness results (relative):

```{r}
#| echo: false
#| out.width: '100%'
# Print relative results tables:
reTab_3
```

#### EVPPI:

```{r}
#| echo: false
#| out.width: '100%'
# Print relative results tables:
evppi_3
```
:::

------------------------------------------------------------------------

## Scenario 4:

### Seven parameters:

::: panel-tabset
#### Cost-effectiveness results:

```{r}
#| echo: false
#| out.width: '100%'
# Print absolute results tables:
abTab_4
```

#### Cost-effectiveness results (relative):

```{r}
#| echo: false
#| out.width: '100%'
# Print relative results tables:
reTab_4
```

#### EVPPI:

```{r}
#| echo: false
#| out.width: '100%'
# Print relative results tables:
evppi_4
```
:::

------------------------------------------------------------------------
